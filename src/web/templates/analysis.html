{% extends 'views/base.html' %}

{% block title %}{{module.code}} Analysis{% endblock %}

{% block page_title %}{{module.code}} - {{module.name}}{% endblock %}

{% block body %}
<div class="analysis">
    <p>Perform similarity analysis on <a href="{{ paper.get_link(module, format='pdf') }}">{{paper.year_start}} ({{paper.period}}) {{module.name}} paper.</a></p>

    {% for item in analysis %}
    <section>
        <div class="questions">
            <h4 style="width: {{ (item.question.path | length) * 30 }}px">{% for i in item.question.pretty_path %}<span>{{i}}.</span>{% endfor %}</h4>
            <p>{{item.question.content}}</p>
        </div>
        <div class="stats">
            <table>
                <tr><td>Paper</td>{% for year, ps in item.papers.iteritems() %}<td>{{year}}</td>{% endfor %}</tr>
                <tr><td>Question</td>{% for year, subpapers in item.papers.iteritems() -%}
                    <td>{% for suba in (subpapers | sort(attribute='similarity', reverse=True)) -%}
                        <p class="period-{{suba.paper.period | lower}}">
                            <a href="{{ suba.paper.get_link(module) }}#Q{{ suba.question.path | join('.') }}">{% for i in suba.question.pretty_path %}<span>{{i}}.</span>{% endfor %}</a><br>
                        <i>({{suba.question.paper_id}}, {{ "%.2f" | format(suba.similarity) }})</i></p>
                    {%- endfor %}</td>
                {%- endfor %}</tr>
            </table>
        </div>
    </section>
    {% endfor %}
</div>
{% endblock %}